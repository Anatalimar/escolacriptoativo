<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz sobre Criptoativos</title>
    <style>
        /* Estilos mantidos iguais ao original */
    </style>
</head>
<body>
    <!-- Tela inicial -->
    <div class="quiz-container">
        <div id="start-screen" class="start-screen">
            <h1>Quiz sobre Criptoativos</h1>
            <p>Insira seu nome para começar:</p>
            <input type="text" id="username" placeholder="Seu nome" required>
            <button id="start-btn">Começar Quiz</button>
        </div>
        <!-- Quiz -->
        <div id="quiz" style="display: none;">
            <h1>Quiz sobre Criptoativos</h1>
            <div class="timer" id="timer"></div>
            <div id="question-container"></div>
            <button id="next-btn" style="display: none;">Próxima Pergunta</button>
        </div>
        <!-- Resultado -->
        <div id="result-screen" style="display: none;">
            <div class="result" id="result"></div>
            <div class="ranking" id="ranking"></div>
        </div>
    </div>
    <!-- Ranking (fora do quiz-container) -->
    <div class="ranking-container">
        <div class="ranking-header">Ranking dos Jogadores</div>
        <div id="ranking-display" class="rank-list"></div>
    </div>
    <script>
        // Banco de questões (mantido igual ao original)

        // Variáveis globais
        let username = "";
        let selectedQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timerInterval;

        // Função para formatar a data e hora
        function getFormattedDateTime() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, "0");
            const month = String(now.getMonth() + 1).padStart(2, "0");
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, "0");
            const minutes = String(now.getMinutes()).padStart(2, "0");
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Função para carregar resultados do GitHub
        async function loadRankingFromGitHub() {
            try {
                const response = await fetch('https://api.github.com/repos/SEU_USUARIO/SEU_REPOSITORIO/contents/ranking.json', {
                    headers: {
                        Authorization: `token SEU_TOKEN_DE_ACESSO`,
                        Accept: 'application/vnd.github.v3+json'
                    }
                });

                const data = await response.json();
                const content = JSON.parse(atob(data.content)); // Decodificar base64

                // Exibir ranking
                const rankList = document.getElementById("ranking-display");
                rankList.innerHTML = "";
                if (content.length === 0) {
                    rankList.innerHTML += "<div class='rank-item'>Nenhum resultado registrado ainda.</div>";
                    return;
                }

                content.sort((a, b) => b.score - a.score); // Ordenar por pontuação
                content.forEach((entry, index) => {
                    const stars = getStars(index + 1);
                    rankList.innerHTML += `
                        <div class='rank-item'>
                            ${index + 1}. ${entry.name}: ${entry.score}/10
                            <span class='rank-stars'>${stars}</span>
                            <div class='rank-details'>Concluído em: ${entry.date}</div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar ranking:', error);
            }
        }

        // Função para salvar resultado no GitHub
        async function saveResultToGitHub(name, score) {
            const dateTime = getFormattedDateTime();
            const newResult = { name, score, date: dateTime };

            try {
                // Obter o conteúdo atual do arquivo JSON no GitHub
                const response = await fetch('https://api.github.com/repos/SEU_USUARIO/SEU_REPOSITORIO/contents/ranking.json', {
                    headers: {
                        Authorization: `token SEU_TOKEN_DE_ACESSO`,
                        Accept: 'application/vnd.github.v3+json'
                    }
                });

                const data = await response.json();
                const content = JSON.parse(atob(data.content)); // Decodificar base64

                // Adicionar o novo resultado ao array
                content.push(newResult);

                // Atualizar o arquivo no GitHub
                await fetch('https://api.github.com/repos/SEU_USUARIO/SEU_REPOSITORIO/contents/ranking.json', {
                    method: 'PUT',
                    headers: {
                        Authorization: `token SEU_TOKEN_DE_ACESSO`,
                        Accept: 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Atualizar ranking',
                        content: btoa(JSON.stringify(content)), // Codificar em base64
                        sha: data.sha // SHA do arquivo atual
                    })
                });

                console.log('Resultado salvo no GitHub!');
            } catch (error) {
                console.error('Erro ao salvar resultado:', error);
            }
        }

        // Função para iniciar o quiz
        document.getElementById("start-btn").addEventListener("click", () => {
            username = document.getElementById("username").value.trim();
            if (!username) {
                alert("Por favor, insira seu nome.");
                return;
            }
            // Esconder tela inicial e mostrar quiz
            document.getElementById("start-screen").style.display = "none";
            document.getElementById("quiz").style.display = "block";
            // Selecionar 10 questões aleatórias
            selectedQuestions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 10);
            // Exibir primeira pergunta
            showQuestion();
        });

        // Função para exibir a pergunta atual
        function showQuestion() {
            const questionContainer = document.getElementById("question-container");
            questionContainer.innerHTML = "";
            if (currentQuestionIndex >= selectedQuestions.length) {
                endQuiz();
                return;
            }
            const currentQuestion = selectedQuestions[currentQuestionIndex];
            questionContainer.innerHTML = `
                <p><strong>${currentQuestionIndex + 1}. ${currentQuestion.question}</strong></p>
                <div class="options">
                    ${currentQuestion.options.map(option => `<label><input type="radio" name="q${currentQuestionIndex}" value="${option[0]}"> ${option}</label>`).join("")}
                </div>
            `;
            // Iniciar temporizador
            startTimer();
        }

        // Função para iniciar o temporizador
        function startTimer() {
            let timeLeft = 20; // 20 segundos por pergunta
            document.getElementById("timer").textContent = `Tempo restante: ${timeLeft} segundos`;
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById("timer").textContent = `Tempo restante: ${timeLeft} segundos`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    nextQuestion();
                }
            }, 1000);
        }

        // Função para ir para a próxima pergunta
        function nextQuestion() {
            clearInterval(timerInterval);
            // Verificar resposta
            const currentQuestion = selectedQuestions[currentQuestionIndex];
            const selectedOption = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
            if (selectedOption && selectedOption.value === currentQuestion.answer) {
                score++;
            }
            // Avançar para a próxima pergunta
            currentQuestionIndex++;
            showQuestion();
        }

        // Função para encerrar o quiz
        function endQuiz() {
            clearInterval(timerInterval);
            // Esconder quiz e mostrar resultado
            document.getElementById("quiz").style.display = "none";
            document.getElementById("result-screen").style.display = "block";
            // Salvar resultado no GitHub
            saveResultToGitHub(username, score);
            // Exibir resultado
            document.getElementById("result").textContent = `Sua pontuação: ${score}/10`;
            // Exibir ranking
            const rankingDiv = document.getElementById("ranking");
            if (score >= 9) {
                rankingDiv.textContent = `${username}, você é um Mestre em Criptoativos!`;
            } else if (score >= 7) {
                rankingDiv.textContent = `${username}, você é um Especialista.`;
            } else if (score >= 5) {
                rankingDiv.textContent = `${username}, você é um Iniciante Avançado.`;
            } else {
                rankingDiv.textContent = `${username}, você é um Novato.`;
            }
            // Carregar ranking do GitHub
            loadRankingFromGitHub();
        }

        // Carregar ranking ao carregar a página
        window.onload = loadRankingFromGitHub;
    </script>
</body>
</html>
